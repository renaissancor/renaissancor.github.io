# MSVC Compiler Property 정리

## 1. 문서 목적

이 문서는 Visual Studio 2022 기준 MSVC 프로젝트 설정을
- 무엇을 설정하는지
- Debug / Release에서 어떻게 달라지는지
- 프로젝트/솔루션 단위로 무엇을 통일해야 하는지

정리한 레퍼런스입니다. 

## 2. Tier 1 – 필수 설정 (솔루션 공통)

아래 항목은 MSVC 솔루션 내부 모든 프로젝트에 대해
Debug / Release와 무관하게 동일해야 한다.

- 구성 형식 (Configuration Type)
- 플랫폼 도구 집합 (Platform Toolset)
- C++ / C 언어 표준
- 경고 수준 + /WX
- 런타임 라이브러리 (CRT) 
- C++ 예외 처리 (/EHsc)
- RTTI (/GR)

런타임 라이브러리 Debug/Release 또는 라이브러리 간 불일치 시 링크 오류 및 런타임 크래시 발생

## 3. Tier 2 – 빌드 / 링크 관련 항목

- 추가 포함 디렉터리
- 추가 라이브러리 디렉터리
- 디버그 정보 형식 (/Zi, /Z7)
- 전체 프로그램 최적화 (/GL)
- 링크 타임 코드 생성 (LTCG)
- 증분 링크

## 4. 주요 컴파일러 / 링커 옵션 설명 (Reference)

### 구성 형식 (Configuration Type) 

프로젝트 / 구성 속성 / 일반 / 구성 형식 

- 메이크파일 
- 애플리케이션(.exe)
- 동적 라이브러리(.dll) 
- 정적 라이브러리(.lib) 

링커 동작 

### 플랫폼 도구 집합 (Platform Toolset)

프로젝트 / 구성 속성 / 일반 / 플랫폼 도구 집합 

- Visual Studio 2022 (v143) 
- Visual Studio 2017 

컴파일러 / 링커 버전 결정 

### 경고 수준 

프로젝트 / 구성 속성 / C/C++ / 일반 / 경고 수준 

- 모든 경고 해제(/W0)
- 수준1(/W1)
- 수준2(/W2)
- 수준3(/W3)
- 수준4(/W4)
- 모든경고사용(/WAll) 

프로젝트 / 구성 속성 / C/C++ / 일반 / 경고를 오류로 사용 

- 아니요 (/WX-)
- 예 (/WX)

### 추가 포함 디렉터리 

헤더 파일을 찾을 수 없을 때

프로젝트 / 구성 속성 / C/C++ / 일반 / 추가 포함 디렉터리 

컴파일러가 헤더를 탐색할 디렉터리 목록 

### 런타임 라이브러리 CRT (CPP Runtime Library)

프로젝트 / 구성 속성 / C/C++ / 코드 생성 

플래그 

- 다중 스레드 (/MT)
- 다중 스레드 디버그 (/MTd)
- 다중 스레드 DLL (/MD)
- 다중 스레드 디버그 DLL (/MDd) 

주의 : 라이브러리 전부 동일해야 함

### C++ 예외 처리 

프로젝트 / 구성 속성 / C/C++ / 코드 생성 / C++ 예외 처리 기능 

- 예, SEH 예외 있음 (/EHa)
- 예 (/EHsc)
- 예, Extern C 함수 있음 (/EHs)
- 아니요 

표준 C++ 예외만 사용

### 런타임 형식 정보 RTTI (Run Time Type Information)

프로젝트 / 구성 속성 / C/C++ / 언어 

- 아니오 (/GR-)
- 예 (/GR)

dynamic_cast, typeid 영향 

### 디버그 정보 형식 

- 프로그램 데이터베이스 (/Zi) 
- C7 호환 (/Z7)
- 편집하며 계속 (/ZI)

/Zi: 일반적인 Debug/Release 디버깅 (권장)

/Z7: 단일 obj에 디버그 정보 포함

프로젝트 / 구성 속성 / C/C++ / 일반 

### 최적화 

프로젝트 / 구성 속성 / C/C++ / 최적화 

- 사용 안 함 (/Od)
- 최대 최적화 (크기 우선) (/O1)
- 최대 최적화 (속도 우선) (/O2)
- 최적화 (속도 우선) (/Ox)

최적화 컴파일 시 디버깅 어려움

### 추가 라이브러리 디렉터리 

프로젝트 / 링커 / 일반 / 추가 라이브러리 디렉터리 

.lib 추가 시 


## Debug / Release 모드 컴파일 차이 

| 항목          | Debug  | Release | 설명                          |
| ----------- | ------ | ------- | --------------------------- |
| 최적화         | `/Od`  | `/O2`   | Debug는 코드 구조를 유지하여 디버깅에 유리  |
| 전체 프로그램 최적화 | 사용 안 함 | `/GL`   | Release에서 링크 타임 최적화(LTO) 사용 |
| 증분 링크       | 사용     | 사용 안 함  | Release에서는 전체 링크가 일반적       |
| 함수 인라인      | 제한적    | 적극 사용   | Release에서 성능 향상을 위해 인라인 적용  |
| 다중 프로세서 컴파일 | 선택     | 선택      | 일반적으로 Debug/Release 동일      |

## Debug / Release 모드 런타임 / 디버깅 차이 

| 항목         | Debug    | Release  | 설명                  |
| ---------- | -------- | -------- | ------------------- |
| 런타임 라이브러리  | `/MDd`   | `/MD`    | Debug CRT는 추가 검사 포함 |
| 디버그 정보 생성  | `/Zi`    | `/Zi`    | Release에서도 디버깅 가능   |
| 링커 디버그 옵션  | `/DEBUG` | `/DEBUG` | 최종 PDB 생성 여부        |
| 런타임 검사     | 활성       | 비활성      | 스택, 초기화 검사          |
| assert     | 활성       | 비활성      | `NDEBUG` 매크로 기준     |
| CRT 디버그 검사 | 활성       | 비활성      | 힙 및 메모리 오류 감지       |

## Debug / Release 모드 전처리기 매크로 차이 

| 매크로                     | Debug  | Release | 설명             |
| ----------------------- | ------ | ------- | -------------- |
| `_DEBUG`                | 정의됨    | 정의 안 됨  | Debug 전용 코드 분기 |
| `NDEBUG`                | 정의 안 됨 | 정의됨     | assert 비활성화    |
| `_ITERATOR_DEBUG_LEVEL` | 2      | 0       | STL 반복자 검사 수준  |

## Debug / Release 동작 차이로 인한 주의사항

| 항목       | Debug  | Release       | 영향               |
| -------- | ------ | ------------- | ---------------- |
| 변수 초기화   | 비교적 안전 | 초기화되지 않을 수 있음 | 정의되지 않은 동작 발생 가능 |
| 코드 재배치   | 최소     | 적극적           | 실행 순서 변경 가능      |
| 실행 속도    | 느림     | 빠름            | 타이밍 의존 버그 노출     |
| 메모리 레이아웃 | 안정적    | 공격적           | 메모리 접근 오류 가능     |

### Debug 모드에서 나타나지 않다가 Release 모드에서 발생하는 문제들 

- 초기화되지 않은 변수 사용
- 정의되지 않은 동작(Undefined Behavior)
- assert에 의존한 로직
- Debug/Release CRT 혼용
- 최적화 옵션으로 인한 코드 재배치 

## Release 빌드 전 점검 체크리스트

- [ ] Debug / Release CRT 혼용 없음
- [ ] 모든 프로젝트 동일한 Toolset 사용
- [ ] `/EHsc` 사용 확인
- [ ] `/GL` + LTCG 정상 적용
- [ ] 경고 0개 상태에서 빌드 성공
- [ ] assert 제거에 의존한 로직 없음
- [ ] 초기화되지 않은 변수 없음

