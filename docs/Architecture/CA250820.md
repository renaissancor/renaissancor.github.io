# 1. DLL (Dynamic-Link Library)과 링크 방식

**DLL**은 여러 프로그램이 공유할 수 있는 실행 가능한 코드와 데이터를 담고 있는 파일입니다. Visual Studio에서 프로젝트를 빌드할 때 사용하는 런타임 라이브러리(`/MT`, `/MD`)와 `WINAPI` 함수들은 모두 DLL과 관련이 있습니다.

* **정적 링크 (`/MT`)**: C/C++ 런타임 라이브러리 코드가 최종 실행 파일(`exe`)에 직접 포함됩니다. 파일 크기가 커지지만, 별도의 DLL 없이 실행할 수 있습니다.
* **동적 링크 (`/MD`)**: 런타임 라이브러리 코드가 `.exe`에 포함되지 않고, 별도의 DLL 파일에 존재합니다. 실행 파일 크기는 작지만, 해당 DLL이 없으면 실행되지 않습니다.
* **`WINAPI`와 `DLL`**: `GetTickCount`, `Sleep`과 같은 기본적인 `WINAPI` 함수들은 대부분 `kernel32.dll`과 같은 시스템 DLL에 포함되어 있습니다. 이러한 DLL들은 Windows에 기본적으로 설치되어 있어 별도의 링크 설정 없이 사용할 수 있는 경우가 많습니다.

**`#pragma comment`**: 이 지시문은 소스 코드에 직접 링커 옵션을 추가하는 방법입니다. 예를 들어, `#pragma comment(lib, "winmm.lib")`는 `winmm.lib`라는 라이브러리를 링크하라는 의미로, Visual Studio 프로젝트 속성에서 "추가 종속성"에 라이브러리 이름을 직접 추가하는 것과 동일한 효과를 가집니다.

---

### 2. 서버 분산 설계와 네트워크

게임 서버를 여러 대의 하드웨어로 분산하는 설계에서, 사용자와 서버 간의 연결 방식은 여러 가지가 있습니다.

* **단일 엔드포인트 방식**:
    * 사용자는 하나의 대표 IP(엔드포인트)를 통해 접속합니다.
    * 이 IP는 **로드 밸런서**나 **프록시 서버**로 연결됩니다.
    * 로드 밸런서는 사용자 트래픽을 여러 서버에 분산하여 부하를 조절합니다.
    * 프록시 서버는 실제 게임 서버의 IP를 숨겨 **DDoS 공격**을 방어하는 역할을 합니다. 사용자가 프록시 서버만 알기 때문에, 공격자는 실제 게임 서버를 직접 공격하기 어렵습니다. 
* **다중 엔드포인트 방식**:
    * 각 지역 서버가 고유의 IP(엔드포인트)를 가집니다.
    * 사용자가 지역을 이동할 때, 기존 서버와의 연결을 끊고 새로운 지역 서버로 재연결하는 과정을 거칩니다.

### 3. 게임 서버의 보안과 통신

TCP/IP는 자체적으로 보안 기능이 없으므로, **IP Spoofing(IP 위조)**과 같은 공격에 취약합니다. 게임 서버에서는 이를 방지하기 위해 다양한 방법을 사용합니다.

* **시퀀스 번호**: TCP 통신은 패킷에 순서 번호를 부여하여 패킷의 순서가 뒤섞이거나 위조되는 것을 방지합니다.
* **인증 및 암호화**: 웹 서버처럼 매번 인증 토큰을 보내지는 않지만, 초기 접속 시 인증 과정을 거쳐 **세션(Session)**을 수립하고, 이후 통신은 해당 세션을 통해 이루어집니다. 중요한 데이터는 암호화하여 패킷 변조를 막습니다.
* **DDos 공격**: 네트워크 트래픽을 과도하게 발생시켜 서버를 마비시키는 공격입니다. 로직으로 해결할 수 없으며, **하드웨어(방화벽)**나 **프록시 서버**를 통해 방어합니다.

---

### 4. 게임 서버 아키텍처와 분산의 이유

게임 서버를 분산하는 가장 큰 이유는 **부하 분산**과 **네트워크 트래픽 한계** 때문입니다.

* **단일 서버의 한계**:
    * 아무리 고성능 CPU를 사용해도, 단일 프로세스가 처리할 수 있는 동시 접속자 수에는 한계가 있습니다.
    * 특히, 네트워크 트래픽 처리량에 한계가 있어 한 서버에 너무 많은 사용자가 접속하면 네트워크 장비가 마비될 수 있습니다.
* **DB 부하**:
    * 게임 서버는 사용자 행동을 실시간으로 DB에 저장해야 합니다. DB는 CPU 연산에 비해 매우 느리고, 동시 접속자가 많아지면 DB에 과부하가 걸립니다.
    * **월드(World)를 분리하는 가장 큰 이유 중 하나는 DB를 분리하기 위함**입니다. 각 월드가 독립적인 DB를 사용하게 하여 DB 부하를 분산시킵니다.
* **채널(Channel)**:
    * 동일한 지역에 사용자가 몰리는 것을 막기 위해 해당 지역을 여러 개의 채널로 분리하여 운영하는 방식입니다.
    * 월드 분리와 달리, 채널은 동일한 DB를 공유하며, 상호작용이 불가능한 별도의 공간을 제공합니다. 이는 **부하 분산을 위한 기술적 해결책**이면서 **확장이 용이**한 장점이 있습니다.

---

### 5. 게임 서버 개발의 실제

* **서버 구조**:
    * 대부분의 MMO는 **단일 프로세스-단일 월드** 구조를 선호합니다. 한 서버 프로세스가 하나의 월드를 담당하게 설계하는 것이 로직이 가장 단순하고 관리하기 쉽습니다.
    * MMO는 유저 간 상호작용이 많아 DB를 분산하기 어렵기 때문에, 대부분의 서버는 **하나의 DB에 의존**합니다.
    * **논-MMO** 게임(배틀그라운드, 오버워치 등)은 **Dedicated Server**를 사용하여 게임 한 판마다 독립적인 서버 프로세스를 생성하고, 게임이 끝나면 프로세스를 종료합니다. 이 경우 DB 분산 설계가 MMO보다 용이합니다.

* **서버 프로그래머의 역할**:
    * 서버 프로그래머는 단순한 서버 로직 구현뿐만 아니라, **클라이언트의 네트워크 코드도 담당**하는 경우가 많습니다. 클라이언트가 서버와 통신하는 방식, 패킷 처리, 동기화 등을 서버 개발자가 설계하고 구현해야 하기 때문입니다.

* **DB 설계**:
    * DB 설계는 매우 중요합니다. 인덱스를 잘 설정하면 수십억 개의 데이터가 있어도 검색 속도를 빠르게 유지할 수 있습니다.
    * 인벤토리 최대치 등은 **기획적인 이유**가 크지만, 때로는 **DB 설계의 한계** 때문에 늘리기 어려운 경우도 있습니다.

---

### 6. 참고 용어 및 개념

* **프록시 서버**: 클라이언트와 서버 사이에서 대리인 역할을 하는 서버.
* **Dedicated Server**: 특정 게임 플레이를 위해 독립적으로 운영되는 서버.
* **인스턴스 던전**: 특정 그룹만 입장할 수 있는 독립적인 던전 공간. 게임 서버 내에서 스레드나 프로세스를 생성하여 관리하는 경우가 많습니다.
* **클라우드 서버**: 가변적인 부하에 따라 서버 수를 유연하게 조절할 수 있어 채널이 유동적으로 생성되는 **가변 채널 시스템**에 적합합니다.