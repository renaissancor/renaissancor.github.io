
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ECE482L7/">
      
      
        <link rel="next" href="../ECE482L9/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Lab 08 - Renaissancor</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-08" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Renaissancor" class="md-header__button md-logo" aria-label="Renaissancor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Renaissancor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 08
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Renaissancor" class="md-nav__button md-logo" aria-label="Renaissancor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Renaissancor
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to MkDocs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AR250402/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AR250402
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ECE482FA24
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            ECE482FA24
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ECE482HW
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            ECE482HW
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment I
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment II
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment III
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment IV
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment V
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment VI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment VII
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482HW/ECE482H8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment VIII
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ECE482LAB
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            ECE482LAB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 10
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 11
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 04
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 05
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 06
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 07
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lab 08
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lab 08
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1 Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-looking-at-the-linux-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      2 Looking at the Linux kernel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#21-looking-at-the-linux-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Looking at the Linux kernel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-a-page-fault-handler-using-ebpf" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 A page-fault handler using eBPF
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECE482L9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 09
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ECE482P2
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            ECE482P2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P2/Design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P2/DeveloperGuide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P2/Home/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project 2 LemonDB Multi Threading Database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P2/MultiThreading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-threading Challenges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P2/Performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance Improvements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P2/RoadMap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Road Map
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ECE482P3
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            ECE482P3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P3/Design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P3/Developer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P3/Home/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project 3 Lottery Scheduling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P3/Performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P3/Risk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project 3 Lottery Scheduling Risk Assessment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ECE482P3/RoadMap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project 3 Lottery Scheduling RoadMap
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1 Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-looking-at-the-linux-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      2 Looking at the Linux kernel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#21-looking-at-the-linux-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Looking at the Linux kernel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-a-page-fault-handler-using-ebpf" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 A page-fault handler using eBPF
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="lab-08">Lab 08</h1>
<p>ECE4820 FA2024 Introduction to Operating Systems</p>
<p>518370990004 Jae Heung Park</p>
<hr />
<h2 id="1-introduction">1 Introduction</h2>
<p>Reading</p>
<h2 id="2-looking-at-the-linux-kernel">2 Looking at the Linux kernel</h2>
<blockquote>
<p>First you notice references to concepts and topics you have already seen but never dared to look at in
details. The all seem to be related to coding quality, which you already know is of a critical importance
when working at the kernel level.</p>
</blockquote>
<p><strong>What are kmsan, kasan, kfence folders?</strong></p>
<p>KMSAN (Kernel Memory Sanitizer)</p>
<ul>
<li>Linux uninitialized kernel memory error detection</li>
<li>Maintain shadow memory that track kernel memory initialization status</li>
<li>Debug by uninitialized variable detection</li>
</ul>
<p>KASAN (Kernel Address Sanitizer)</p>
<ul>
<li>Out of Bounds and Use after free error detector</li>
<li>Also use shadow memory that track whether memory access is valid</li>
<li>Provide debug info and help to find problematic idea</li>
</ul>
<p>KFENCE (Kernel Fence)</p>
<ul>
<li>Lightweight detector for production</li>
<li>Minimal performance, appropriate for live environments</li>
</ul>
<p><strong>What is shadow memory and how does it relate to sanitizers?</strong></p>
<p>Shadow memory is portion of memory reserved to store metadata
by tracking whether region is valid or not
at the actual memory (primary memory) inside OS kernel</p>
<p>Sanitizers use shadow memory to mark invalid or not initialized memory,
track memory access, or find common error including use-after-free,
out-of-bounds, etc.</p>
<p><strong>What are sanitizers and why are they essential when coding in the kernel level?</strong></p>
<p>Sanitizers dynamically detect bugs like memory errors, invalid accesses, etc.<br />
KMSAN, KASAN, KFENCE above are all sanitizers.</p>
<p>Sanitizers can detect memory error, so it is essential in low level programming memory management.
If memory is corrupted, then OS will not only waste resource but also have several security resources.<br />
Moreover, kernel interaction to hardware might be compromised, even result in system crash.
Since debugging memory without sanitizer is extremely challenging.</p>
<p><strong>What is <code>kmemleak.c</code> file about? Explain who should “use” it and under what circumstances</strong></p>
<p>File <code>kmemleak.c</code> is about memory leak detection.
It will track all dynamically allocated memories to detect memory leakage in a real time.</p>
<p>During programming for kernel, it is necessary to debug memory.
Thus, it will be really useful in kernel level module modification that require
a lot of allocating and freeing memories.</p>
<blockquote>
<p>You also notice two interesting files:</p>
</blockquote>
<p><strong><code>nommu.c</code>: when would this file be used? List some drawbacks of having CPU without any MMU.</strong></p>
<p>File <code>nommu.c</code> is (NO Memory Management Unit). This is useful in circumstances with limited
resources like embedded systems.</p>
<p>CPU Drawbacks without MMU will have these problems</p>
<ul>
<li>No Virtual Memory, only physical memory could be used.</li>
<li>No Memory Protection, isolated process will make system corruption and crashes more vulnerable</li>
<li>Memory fragmentation issue and limited ability for handling several processes simultaneously</li>
<li>Harder debugging, as no VM and memory management is more sophisticated</li>
</ul>
<p><strong><code>compaction.c</code>: what is this file used for? Why is “memory compaction” important?</strong></p>
<p>File <code>compaction.c</code> reduce fragmentation by moving freed memory blocks to restore memory spaces.</p>
<p>This compaction is important when memory allocation for large amount of data is completed.
Efficient memory allocation is really important for specific processes or devices that must
have contiguous memory like DMA buffers. Optimized performance will significantly reduce
fallback strategies, maintaining high system performance.</p>
<blockquote>
<p>As you keep looking at the files in the mm directory of the Linux source code as name stands out:
oom_kill.c. This sounds scary! What could be killed. You open the files and discover that it features
long interesting comments.</p>
</blockquote>
<p><strong>What is the OOM killer? In particular what does OOM mean?</strong></p>
<p>OOM (Out of Memory) is status when system run out of both physical memory and even
reached to limit of SSD swap memory, so that no space has left to allocate resources
for new processes.</p>
<p>OOM Killer is OS kernel mechanism that will free memory
by process termination especially when system memory is low.
It will avoid necessary processes and kill useless processes by
distinguishing them by heuristic algorithm.</p>
<p><strong>Based on the source code and comments, explain what could be a reason for a deadlock in the
Linux kernel?</strong></p>
<p>Hint. There is no need to read the whole source code, simply run a search on a well chosen keyword.</p>
<p><a href="https://github.com/torvalds/linux/blob/master/mm/oom_kill.c">Source code of<code>oom_kill.c</code></a></p>
<pre><code class="language-shell">grep -i &quot;deadlock&quot; oom_kill.c
</code></pre>
<pre><code class="language-c++">        panic(&quot;System is deadlocked on memory\n&quot;);
</code></pre>
<pre><code class="language-shell">grep -i &quot;mutex&quot; oom_kill.c
</code></pre>
<pre><code class="language-c++">DEFINE_MUTEX(oom_lock);
DEFINE_MUTEX(oom_adj_mutex);
    if (mutex_lock_killable(&amp;oom_lock))
    mutex_unlock(&amp;oom_lock);
</code></pre>
<pre><code class="language-shell">grep -i &quot;wait&quot; oom_kill.c
</code></pre>
<pre><code class="language-c++">static DECLARE_WAIT_QUEUE_HEAD(oom_victims_wait);
static DECLARE_WAIT_QUEUE_HEAD(oom_reaper_wait);
                wait_event_freezable(oom_reaper_wait, oom_reaper_list != NULL);
        wake_up(&amp;oom_reaper_wait);
 * before the exit path is able to wake the futex waiters.
        wake_up_all(&amp;oom_victims_wait);
 * @timeout: maximum timeout to wait for oom victims in jiffies
 * Will block and wait until all OOM victims are killed or the given
    ret = wait_event_interruptible_timeout(oom_victims_wait,
</code></pre>
<pre><code class="language-shell">grep -i &quot;lock&quot; oom_kill.c
</code></pre>
<pre><code class="language-c++"> * oom_killer_disable() relies on this lock to stabilize oom_killer_disabled
DEFINE_MUTEX(oom_lock);
rcu_read_lock();
rcu_read_unlock();
* task_lock() held.
struct task_struct *find_lock_task_mm(struct task_struct *p)
rcu_read_lock();
task_lock(t);
task_unlock(t);
rcu_read_unlock();
p = find_lock_task_mm(p);
task_unlock(p);
task_unlock(p);
rcu_read_lock();
rcu_read_unlock();
task = find_lock_task_mm(p);
task_unlock(task);
rcu_read_lock();
rcu_read_unlock();
static DEFINE_SPINLOCK(oom_reaper_lock);
* we do not want to block exit_mmap by keeping mm ref
if (mmu_notifier_invalidate_range_start_nonblock(&amp;range)) {
if (!mmap_read_trylock(mm)) {
* under mmap_lock for reading because it serializes against the
* mmap_write_lock();mmap_write_unlock() cycle in exit_mmap().
goto out_unlock;
out_unlock:
mmap_read_unlock(mm);
/* Retry the mmap_read_trylock(mm) a few times */
debug_show_all_locks();
* somebody can't call mmap_write_unlock(mm).
spin_lock_irq(&amp;oom_reaper_lock);
spin_unlock_irq(&amp;oom_reaper_lock);
spin_lock_irqsave(&amp;oom_reaper_lock, flags);
spin_unlock_irqrestore(&amp;oom_reaper_lock, flags);
* Has to be called with oom_lock held and never after
* under task_lock or operate on the current).
* any memory and livelock. freezing_slow_path will tell the freezer
* Will block and wait until all OOM victims are killed or the given
if (mutex_lock_killable(&amp;oom_lock))
mutex_unlock(&amp;oom_lock);
* Caller has to make sure that task-&gt;mm is stable (hold task_lock or
* on that for now. We can consider find_lock_task_mm in future.
rcu_read_lock();
rcu_read_unlock();
p = find_lock_task_mm(victim);
/* Get a reference to safely compare mm after task_unlock(victim) */
task_unlock(victim);
* depletion of all memory.  This prevents mm-&gt;mmap_lock livelock when an
rcu_read_lock();
rcu_read_unlock();
task_lock(victim);
task_unlock(victim);
task_unlock(victim);
static BLOCKING_NOTIFIER_HEAD(oom_notify_list);
int register_oom_notifier(struct notifier_block *nb)
return blocking_notifier_chain_register(&amp;oom_notify_list, nb);
int unregister_oom_notifier(struct notifier_block *nb)
return blocking_notifier_chain_unregister(&amp;oom_notify_list, nb);
blocking_notifier_call_chain(&amp;oom_notify_list, 0, &amp;freed);
panic(&quot;System is deadlocked on memory\n&quot;);
* any locks held but let the oom killer triggered from the allocation context care
p = find_lock_task_mm(task);
task_unlock(p);
if (mmap_read_lock_killable(mm)) {
* Check MMF_OOM_SKIP again under mmap_read_lock protection to ensure
mmap_read_unlock(mm);
</code></pre>
<p>In <code>oom_lock</code> mutex is used to serialize access to the OOM Killer mechanism.
It also defines several locks and wait queues for OOM victims and the OOM reaper.
Various locks used are</p>
<ul>
<li>Mutexes (oom_lock, oom_adj_mutex)</li>
<li>Spinlocks (oom_reaper_lock)</li>
<li>RCU locks (rcu_read_lock)</li>
</ul>
<p>If locks are in inconsistent order, deadlock risk exists.</p>
<blockquote>
<p>As you keep exploring the mm directory you notice a few swap related filenames. Without opening them
you start thinking of the swap and a few questions come to your mind. You know that the kernel and
user spaces memory are separated but what about the swap? You decide to run a quick online search to
understand</p>
</blockquote>
<p><strong>The “rough” layout of kernel and user space memories;</strong></p>
<p>Kernel Space Memory</p>
<ul>
<li>Reserved for core functions of OS kernel code, memory stack, heap, and kernel level data .</li>
<li>Accessible only in ring 0, privileged mode, to ensure stability.</li>
</ul>
<p>User Space Memory</p>
<ul>
<li>Used by user-level processes and applications</li>
<li>Includes process data, stack, and heap.</li>
<li>Runs in ring 3, unprivileged mode, that could isolate user processes from kernel.</li>
</ul>
<p><strong>Whether or not kernel memory can be swapped and why;</strong></p>
<p>If kernel memory swap occurs, then OS kernel can be severely compromised in speed and stability.
Kernel memory swap must be prohibited, and only user level process memory should be swapped.</p>
<blockquote>
<p>At this stage it is pretty clear that directly working in the kernel for MM is to complicated. Unfortunately
with the pressure Mr. Frown puts on you, it is very hard for you to find enough time to properly investigate
the benefits of MGLRU as you initially intended. Therefore you decide to keep searching online for some
task that would prove that Mum Generally Loves to be Really Unfair! And again you are back with this
MGLRU! Interestingly you suddenly land on this kernel documentation page. It shows how to enable and
disable MGLRU from the user-space! What if you could work with MM from the user-space?</p>
</blockquote>
<h2 id="21-looking-at-the-linux-kernel">2.1 Looking at the Linux kernel</h2>
<blockquote>
<p>While searching information about MM in user-space you notice many recent research articles related to
something called eBPF. As this seems to be a brand new topic this is likely a very idea to look into it:
maybe being knowledgeable on it could earn you a better job without Mr. Frown! This really looks worth
the effort, so you decide to read some documentation and follow a short presentation on the topic.</p>
</blockquote>
<p>eBPF (Extended Berkeley Packet Filter)</p>
<p>The eBPF, (Extended Berkeley Packet Filter, guarantees secure execution of user programs at kernel level.
This technology is commonly applied in to observe performance, computer security, and network status.
These programs are possible to be injected inside kernel, so that
all memory events inside are detected and viewed without changing source code of kernel.</p>
<h2 id="22-a-page-fault-handler-using-ebpf">2.2 A page-fault handler using eBPF</h2>
<blockquote>
<p>At the end of the presentation you realise that you have everything you need! The eBPF approach can
work magic for you: no need to dig any further into Linux MM with long and complex code. You can
simply run memory pressure tests with and without MGLRU enabled. For that you just need to monitor
page-faults using an eBPF program. This sounds like a nice starting point to learn more about this
intriguing technology which bridges the gap between monolithic and micro kernels, by safely “injecting”
and “running” user-defined code into kernel space!</p>
</blockquote>
<p>First, install <code>bpf</code>, its trace tool, and <code>stress-ng</code>.</p>
<pre><code class="language-shell">sudo apt-get install bpfcc-tools linux-headers-$(uname -r)
sudo apt-get install bpftrace
sudo apt-get install stress-ng
</code></pre>
<p>Use <code>brew</code> for macOS.</p>
<pre><code class="language-shell">brew install bcc
brew install bpftrace
brew install stress-ng
</code></pre>
<p>Second, write down short eBPF script.</p>
<pre><code class="language-c++">#include &lt;linux/mm_types.h&gt;

int handle_page_fault(struct pt_regs *ctx, struct mm_struct *mm) {
    bpf_trace_printk(&quot;Page fault in process: %d\n&quot;, mm-&gt;owner-&gt;pid);
    return 0;
}
</code></pre>
<p>Now, execution will require Kernel event eBPF attachment and Memory pressure test running.</p>
<pre><code class="language-shell">sudo bpftrace -e 'tracepoint:exceptions:page_fault_user { printf(&quot;Page fault in process: %d\n&quot;, pid); }'
./page_fault_loader page_fault.c
stress-ng --vm 1 --vm-bytes 90% --timeout 60s
</code></pre>
<p>Finally, compare results.</p>
<p>Sources</p>
<ul>
<li><a href="https://brendangregg.com/blog/2019-01-01/learn-ebpf-tracing.html">eBPF Tracing: Tutorial and Examples</a></li>
<li><a href="https://manpages.ubuntu.com/manpages/focal/man1/stress-ng.1.html">stress-ng: A Tool to Load and Stress a Computer System</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>